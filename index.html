<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Surf">
<title>Surf</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@500;600&display=swap');
:root{--bg:#FAF9F5;--card:#FFFFFF;--text:#1C1C1E;--t2:#8A8985;--t3:#C4C3BE;--accent:#1A7AE6;--abg:rgba(26,122,230,.06);--green:#2EBD52;--red:#E8453A;--orange:#E89A0A;--brd:rgba(40,35,20,.06);--sh:0 1px 4px rgba(30,25,10,.03);--st:env(safe-area-inset-top,0px);--sb:env(safe-area-inset-bottom,0px);--f:'DM Sans',-apple-system,sans-serif;--fs:'Playfair Display',Georgia,serif}
html.dark{--bg:#1A1A1D;--card:#2C2C2E;--text:#F0EFEA;--t2:#9A9A9A;--t3:#5A5A5C;--accent:#4A9FF5;--abg:rgba(74,159,245,.1);--green:#34D058;--red:#F45050;--orange:#F0A830;--brd:rgba(255,255,255,.08);--sh:0 1px 4px rgba(0,0,0,.2)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
html,body{height:100%;overflow:hidden;font-family:var(--f);background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;transition:background .3s,color .3s}
[contenteditable]{-webkit-user-select:text;user-select:text}textarea,input{-webkit-user-select:text;user-select:text}

/* ‚ïê‚ïê LAYOUT ‚ïê‚ïê */
.app{height:100%;display:flex;flex-direction:column;padding-top:var(--st);position:relative}
.sb{position:fixed;left:0;top:0;bottom:0;width:260px;background:var(--bg);z-index:210;transform:translateX(-100%);transition:transform .3s cubic-bezier(.22,1,.36,1);box-shadow:4px 0 24px rgba(30,25,10,.08);display:flex;flex-direction:column;padding-top:var(--st)}
.sb.on{transform:translateX(0)}
.sb-ov{position:fixed;inset:0;background:rgba(0,0,0,0);z-index:200;display:none;transition:background .25s}.sb-ov.on{display:block;background:rgba(20,18,10,.2)}
.sb-hdr{padding:16px 16px 12px;border-bottom:1px solid var(--brd);display:flex;align-items:center;justify-content:space-between}
.sb-title{font-family:var(--fs);font-size:18px;font-weight:500}
.sb-close{width:28px;height:28px;border:none;background:none;color:var(--t2);cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%}.sb-close:active{background:var(--brd)}.sb-close svg{width:16px;height:16px}
.sb-list{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:6px 0}.sb-list::-webkit-scrollbar{display:none}
.sb-item{display:flex;align-items:center;gap:10px;padding:10px 16px;cursor:pointer;transition:background .1s}.sb-item:active{background:rgba(0,0,0,.03)}
.sb-item.on{background:var(--abg)}.sb-item.on .sb-name{color:var(--accent);font-weight:600}
.sb-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.sb-name{font-size:13px;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text)}
.sb-cnt{font-size:11px;color:var(--t3);flex-shrink:0}
.sb-add{display:flex;align-items:center;gap:8px;padding:12px 16px;border-top:1px solid var(--brd);cursor:pointer;color:var(--accent);font-size:13px;font-weight:500}.sb-add:active{opacity:.6}
.sb-add svg{width:16px;height:16px}
.app-main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;position:relative}

/* ‚ïê‚ïê PTABS ‚ïê‚ïê */
.ptabs{position:absolute;left:0;top:50%;transform:translateY(-50%);z-index:18;display:none;flex-direction:column;gap:1px;background:rgba(40,35,20,.03);overflow-y:auto;-webkit-overflow-scrolling:touch;box-shadow:2px 0 12px rgba(30,25,10,.06);border-radius:0 8px 8px 0;overflow:hidden}
.ptabs.ptabs-open{display:flex}
.ptab{padding:8px 5px;font-family:var(--f);font-size:9px;font-weight:600;color:var(--t2);background:var(--card);cursor:pointer;text-align:center;letter-spacing:-.2px;line-height:1.2;white-space:nowrap;transition:all .15s;min-width:42px}
.ptab:active{background:var(--abg)}
.ptab.on{color:var(--accent);background:var(--abg)}

/* ‚ïê‚ïê HEADER ‚ïê‚ïê */
.hdr{padding:8px 16px 0;flex-shrink:0;z-index:20}
.hdr-r{display:flex;align-items:center;margin-bottom:6px;gap:4px}
.logo{font-family:var(--fs);font-size:20px;font-weight:500;letter-spacing:-.5px;flex-shrink:0}.logo b{color:var(--accent);font-weight:500}
.hdr-tabs{flex:1;display:flex;background:rgba(0,0,0,.04);border-radius:8px;padding:2px;margin:0 8px}
html.dark .hdr-tabs{background:rgba(255,255,255,.06)}
.hdr-b{display:flex;gap:0;flex-shrink:0}
.hb{width:36px;height:36px;border:none;border-radius:50%;background:0;color:var(--t2);display:flex;align-items:center;justify-content:center;cursor:pointer}.hb:active{background:var(--brd)}.hb svg{width:18px;height:18px}
.vb{flex:1;padding:6px 0;border:none;background:0;font-family:var(--f);font-size:13px;font-weight:500;color:var(--t2);border-radius:6px;cursor:pointer;transition:all .15s}.vb.on{background:var(--card);color:var(--text);box-shadow:0 1px 3px rgba(0,0,0,.06)}
.sub-bar{display:flex;align-items:center;justify-content:center;gap:4px;margin-bottom:6px}
.sub{border:none;background:0;font-family:var(--f);font-size:12px;font-weight:500;color:var(--t3);cursor:pointer;padding:2px 6px;border-radius:4px;transition:all .15s}.sub.on{color:var(--text);font-weight:600}.sub:active{opacity:.7}
.sub-dot{color:var(--t3);font-size:10px}

/* ‚ïê‚ïê PROJ DROPDOWN ‚ïê‚ïê */
.proj-bar{position:relative;margin-bottom:6px}
.proj-btn{display:flex;align-items:center;gap:8px;width:100%;padding:8px 14px;border:1.5px solid var(--brd);border-radius:10px;background:var(--card);font-family:var(--f);font-size:15px;font-weight:500;color:var(--text);cursor:pointer}
.proj-btn .pbl{flex:1;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.proj-btn .pbl.sel{font-family:var(--fs);font-size:22px;font-weight:500;letter-spacing:-.3px}
.proj-btn .pbc{font-size:11px;color:var(--t3);font-weight:400}
.proj-btn .pba{color:var(--t3);font-size:13px;transition:transform .2s}.proj-btn.open .pba{transform:rotate(180deg)}
.proj-dd{position:absolute;top:100%;left:0;right:0;margin-top:4px;background:var(--card);border-radius:12px;box-shadow:0 8px 32px rgba(30,25,10,.12);z-index:50;max-height:0;overflow:hidden;opacity:0;transition:max-height .3s cubic-bezier(.22,1,.36,1),opacity .2s}.proj-dd.open{max-height:360px;opacity:1;overflow:auto}.proj-dd::-webkit-scrollbar{display:none}
.proj-search{position:sticky;top:0;background:var(--card);padding:10px 12px 8px;border-bottom:1px solid var(--brd);z-index:1}
.proj-search input{width:100%;border:none;outline:none;font-family:var(--f);font-size:13px;color:var(--text);background:0}.proj-search input::placeholder{color:var(--t3)}
.pi{display:flex;align-items:center;gap:10px;padding:9px 14px;cursor:pointer}.pi:active{background:rgba(0,0,0,.03)}.pi.on{background:var(--abg)}.pi.on .pin{color:var(--accent);font-weight:600}
.pid{width:5px;height:5px;border-radius:50%;flex-shrink:0}.pin{font-size:13px;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.pic{font-size:11px;color:var(--t3)}
.proj-no{padding:16px;text-align:center;font-size:12px;color:var(--t3)}

/* ‚ïê‚ïê SEARCH ‚ïê‚ïê */
.tsrch{padding:6px 20px;border-bottom:1px solid var(--brd);display:none;flex-shrink:0}.tsrch.on{display:block}
.tsrch input{width:100%;border:none;outline:none;font-family:var(--f);font-size:13px;color:var(--text);background:0}.tsrch input::placeholder{color:var(--t3)}

/* ‚ïê‚ïê SECTIONS ‚ïê‚ïê */
.sec{padding:20px 20px 6px;position:sticky;top:0;z-index:5;background:var(--bg)}.sec:first-child{padding-top:12px}
.sec-row{display:flex;align-items:baseline;justify-content:space-between}
.sec-name{font-family:var(--fs);font-size:22px;font-weight:500;color:var(--text);letter-spacing:-.3px;outline:none;flex:1;min-width:0;line-height:1.3}.sec-name:focus{color:var(--accent)}
.sec-cnt{font-size:11px;color:var(--t3);margin-left:8px;flex-shrink:0}

/* ‚ïê‚ïê CARDS VIEW ‚ïê‚ïê */
.cv{flex:1;overflow:hidden;display:none;flex-direction:column;position:relative}.cv.on{display:flex}
.cf{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:0 0 90px}.cf::-webkit-scrollbar{display:none}
.cc{background:var(--card);border-radius:12px;padding:10px 14px;margin:0 16px 5px;box-shadow:var(--sh);position:relative;overflow:hidden;touch-action:pan-y}
.cc::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px}.cc.ph::before{background:var(--red)}.cc.pm::before{background:var(--orange)}
.cc .sl,.cc .sr{position:absolute;top:0;bottom:0;width:50px;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;z-index:2}
.cc .sl{left:0;background:linear-gradient(90deg,rgba(46,189,82,.7),transparent)}.cc .sr{right:0;background:linear-gradient(-90deg,rgba(232,69,58,.7),transparent)}
.cc .sl svg{color:var(--green);width:18px;height:18px}.cc .sr svg{color:var(--red);width:18px;height:18px}
.cc-t{font-size:16px;font-weight:500;line-height:1.35;letter-spacing:-.1px}
.cc.dn{opacity:.3}.cc.dn .cc-t{text-decoration:line-through;color:var(--t2)}

/* ‚ïê‚ïê FAB + QUICK ADD ‚ïê‚ïê */
.fab{position:absolute;bottom:12px;right:20px;width:46px;height:46px;border-radius:50%;background:var(--accent);color:#fff;border:none;box-shadow:0 4px 14px rgba(26,122,230,.3);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;transition:transform .15s}.fab:active{transform:scale(.9)}.fab svg{width:20px;height:20px}
.qadd{position:absolute;bottom:12px;left:16px;right:76px;background:var(--card);border-radius:12px;box-shadow:0 4px 20px rgba(30,25,10,.1);padding:10px 14px;z-index:11;transform:translateY(16px);opacity:0;pointer-events:none;transition:all .2s cubic-bezier(.22,1,.36,1)}.qadd.on{transform:translateY(0);opacity:1;pointer-events:all}
.qadd input{width:100%;border:none;outline:none;font-family:var(--f);font-size:16px;color:var(--text);background:0}.qadd input::placeholder{color:var(--t3)}
.qadd-h{font-size:9px;color:var(--t3);margin-top:3px}

/* ‚ïê‚ïê LIST VIEW ‚ïê‚ïê */
.lv{flex:1;overflow:hidden;display:none;flex-direction:column}.lv.on{display:flex}
.ln{padding:8px 20px;border-bottom:1px solid var(--brd);flex-shrink:0}
.ln input{width:100%;border:none;outline:none;font-family:var(--f);font-size:16px;color:var(--text);background:0}.ln input::placeholder{color:var(--t3)}
.ls{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:80px}.ls::-webkit-scrollbar{display:none}
.li{display:flex;align-items:center;gap:10px;padding:7px 20px;min-height:38px;position:relative}
.li.dragging{opacity:.4;background:var(--card);box-shadow:0 4px 16px rgba(0,0,0,.08)}
.lp{width:3px;height:3px;border-radius:50%;flex-shrink:0}.lp.high{background:var(--red)}.lp.medium{background:var(--orange)}
.lk{width:18px;height:18px;flex-shrink:0;border:1.5px solid var(--t3);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s cubic-bezier(.34,1.56,.64,1)}.lk:active{transform:scale(.85)}
.li.dn .lk{background:var(--green);border-color:var(--green)}
.lk svg{width:10px;height:10px;color:#fff;opacity:0;transform:scale(0);transition:all .2s cubic-bezier(.34,1.56,.64,1)}.li.dn .lk svg{opacity:1;transform:scale(1)}
.lt{flex:1;font-size:16px;line-height:1.35;color:var(--text);word-break:break-word;outline:none;-webkit-user-modify:read-write-plaintext-only}.lt:focus{color:var(--accent)}.li.dn .lt{color:var(--t3);text-decoration:line-through}
.ldel{width:24px;height:24px;flex-shrink:0;color:var(--t3);cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .15s}.ldel:active{background:rgba(232,69,58,.1);color:var(--red)}.ldel svg{width:13px;height:13px}
.ldh{color:var(--t3);flex-shrink:0;display:flex;align-items:center;cursor:grab;padding:4px;touch-action:none}.ldh svg{width:14px;height:14px}
.sh{padding:14px 20px 4px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--t3);display:flex;justify-content:space-between}
.sh button{font-size:10px;color:var(--t3);border:none;background:0;cursor:pointer;font-family:var(--f)}

/* ‚ïê‚ïê NOTES VIEW ‚ïê‚ïê */
.nv{flex:1;overflow:hidden;display:none;flex-direction:column}.nv.on{display:flex}
.nh{font-size:11px;color:var(--t3);padding:6px 20px;border-bottom:1px solid var(--brd);flex-shrink:0;line-height:1.45;display:flex;justify-content:space-between;align-items:center}
.nh code{background:var(--brd);padding:0 4px;border-radius:3px;font-size:10px}
.na{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:10px 20px 120px}.na::-webkit-scrollbar{display:none}
.ne{width:100%;min-height:250px;border:none;outline:none;font-family:var(--f);font-size:16px;line-height:1.6;color:var(--text);background:0;resize:none;padding:0}.ne::placeholder{color:var(--t3)}
.nb-wrap{padding:8px 20px;flex-shrink:0;background:linear-gradient(transparent,var(--bg) 30%)}
.nb{width:100%;padding:12px;border:none;border-radius:8px;background:var(--text);color:var(--bg);font-family:var(--f);font-size:13px;font-weight:600;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,.1)}.nb:active{transform:scale(.98);opacity:.9}

/* ‚ïê‚ïê RITUAL VIEW ‚ïê‚ïê */
.rv{flex:1;overflow:hidden;display:none;flex-direction:column}.rv.on{display:flex}
.rf{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:8px 20px 80px}.rf::-webkit-scrollbar{display:none}
.r-prog{display:flex;align-items:center;gap:10px;padding:12px 0 16px}
.r-bar{flex:1;height:4px;background:var(--brd);border-radius:4px;overflow:hidden}.r-bar-fill{height:100%;background:var(--green);border-radius:4px;transition:width .3s}
.r-cnt{font-size:12px;color:var(--t2);font-weight:600;min-width:36px;text-align:right}
.r-sec{margin-bottom:16px}
.r-sec-hdr{font-family:var(--fs);font-size:22px;font-weight:500;color:var(--text);letter-spacing:-.3px;margin-bottom:8px;display:flex;align-items:baseline;justify-content:space-between}
.r-sec-cnt{font-size:11px;color:var(--t3);font-weight:400}
.r-item{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--brd)}
.r-item:last-child{border-bottom:none}
.r-chk{width:18px;height:18px;flex-shrink:0;border:1.5px solid var(--t3);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s cubic-bezier(.34,1.56,.64,1)}.r-chk:active{transform:scale(.85)}
.r-chk.on{background:var(--green);border-color:var(--green)}
.r-chk svg{width:10px;height:10px;color:#fff;opacity:0;transform:scale(0);transition:all .2s cubic-bezier(.34,1.56,.64,1)}.r-chk.on svg{opacity:1;transform:scale(1)}
.r-txt{flex:1;font-size:16px;line-height:1.35;color:var(--text);outline:none;-webkit-user-modify:read-write-plaintext-only;word-break:break-word}.r-txt:focus{color:var(--accent)}.r-txt:empty:before{content:'–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...';color:var(--t3);pointer-events:none}
.r-item.checked .r-txt{color:var(--t3);text-decoration:line-through}
.r-del{width:20px;height:20px;flex-shrink:0;color:var(--t3);cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .15s}.r-item:hover .r-del,.r-item:active .r-del{opacity:1}
.r-del svg{width:12px;height:12px}
.r-add{display:flex;align-items:center;gap:8px;padding:8px 0;cursor:pointer;color:var(--t3);font-size:13px;transition:color .15s}.r-add:active{color:var(--accent)}
.r-add svg{width:16px;height:16px}

/* ‚ïê‚ïê PERSONAL VIEW ‚ïê‚ïê */
.pv{flex:1;overflow:hidden;display:none;flex-direction:column}.pv.on{display:flex}
.pv-hdr{padding:12px 20px 8px;display:flex;align-items:baseline;justify-content:space-between}
.pv-title{font-family:var(--fs);font-size:22px;font-weight:500;letter-spacing:-.3px}
.pv-cnt{font-size:11px;color:var(--t3)}
.pv-input{padding:8px 20px;border-bottom:1px solid var(--brd);flex-shrink:0}
.pv-input input{width:100%;border:none;outline:none;font-family:var(--f);font-size:16px;color:var(--text);background:0}.pv-input input::placeholder{color:var(--t3)}
.pv-list{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:80px}.pv-list::-webkit-scrollbar{display:none}

/* ‚ïê‚ïê BOTTOM BAR ‚ïê‚ïê */
.bot{background:rgba(248,247,242,.95);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-top:1px solid rgba(40,35,20,.08);padding:8px 20px calc(6px + var(--sb));display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
html.dark .bot{background:rgba(26,26,29,.92);border-top-color:rgba(255,255,255,.06)}
.bot-i{font-size:11px;color:var(--t2)}.bot-i b{color:var(--text);font-weight:600}
.bot .hb{color:var(--accent);width:34px;height:34px}

/* ‚ïê‚ïê OVERLAYS ‚ïê‚ïê */
.ov{position:fixed;inset:0;background:rgba(0,0,0,0);z-index:100;display:none;transition:background .3s}.ov.on{display:block;background:rgba(20,18,10,.18);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}
.sht{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-radius:16px 16px 0 0;padding:16px 20px calc(16px + var(--sb));z-index:110;transform:translateY(100%);transition:transform .35s cubic-bezier(.22,1,.36,1);box-shadow:0 -4px 16px rgba(30,25,10,.06);max-width:480px;margin:0 auto}.sht.on{transform:translateY(0)}
.sht-h{width:28px;height:3px;background:var(--t3);border-radius:2px;margin:0 auto 12px;opacity:.2}
.sht h3{font-family:var(--fs);font-size:18px;margin-bottom:12px;font-weight:500}
.si{width:100%;padding:10px 12px;border:1.5px solid var(--brd);border-radius:8px;font-family:var(--f);font-size:14px;background:var(--bg);color:var(--text);outline:none;margin-bottom:8px}.si:focus{border-color:var(--accent)}.si::placeholder{color:var(--t3)}
.sbt{width:100%;padding:12px;border:none;border-radius:8px;background:var(--text);color:var(--bg);font-family:var(--f);font-size:14px;font-weight:600;cursor:pointer}.sbt:active{transform:scale(.98);opacity:.9}
.tst{position:fixed;bottom:calc(54px + var(--sb));left:50%;transform:translateX(-50%) translateY(12px);background:var(--text);color:var(--bg);padding:8px 16px;border-radius:100px;font-size:11px;font-weight:500;box-shadow:0 8px 20px rgba(30,25,10,.12);z-index:200;opacity:0;pointer-events:none;transition:all .25s;white-space:nowrap}.tst.show{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:all}.tst a{color:var(--accent);margin-left:8px;cursor:pointer;font-weight:600;text-decoration:none}
.emp{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:50px 30px;text-align:center}
.emp h3{font-family:var(--fs);font-size:16px;color:var(--t2);font-weight:400;margin-bottom:3px}.emp p{font-size:11px;color:var(--t3)}
.menu-dd{position:absolute;top:48px;right:20px;background:var(--card);border-radius:12px;box-shadow:0 8px 32px rgba(30,25,10,.14);z-index:60;overflow:hidden;max-height:0;opacity:0;transition:max-height .2s,opacity .15s;min-width:180px}.menu-dd.open{max-height:280px;opacity:1}
.menu-item{padding:12px 16px;font-size:13px;cursor:pointer;border-bottom:1px solid var(--brd);white-space:nowrap}.menu-item:last-child{border-bottom:none}.menu-item:active{background:rgba(0,0,0,.03)}

/* ‚ïê‚ïê DESKTOP ‚ïê‚ïê */
@media(min-width:600px){
  .sb-ov{display:none!important}
  .sb{transform:translateX(0);position:relative;box-shadow:none;border-right:1px solid var(--brd)}
  .sb-close{display:none}
  .app{max-width:900px;flex-direction:row;margin:0 auto}
  .app>.sb{flex-shrink:0}
  .logo .hb{display:none}
  .hb-menu{display:none!important}
  .ptabs{display:none!important}
}
</style>
</head>
<body>
<div class="app">
<div class="sb" id="sb">
<div class="sb-hdr"><span class="sb-title">–ü—Ä–æ–µ–∫—Ç—ã</span><button class="sb-close" onclick="closeSB()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
<div class="sb-list" id="sb-list"></div>
<div class="sb-add" onclick="closeSB();openSheet()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
</div>
<div class="sb-ov" id="sb-ov" onclick="closeSB()"></div>
<div class="app-main">
<div class="hdr">
<div class="hdr-r"><button class="hb hb-menu" onclick="togglePtabs()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="logo">Sur<b>f</b></div><div class="hdr-tabs"><button class="vb on" data-v="tasks" onclick="setView('tasks')">–ó–∞–¥–∞—á–∏</button><button class="vb" data-v="notes" onclick="setView('notes')">–ó–∞–º–µ—Ç–∫–∏</button><button class="vb" data-v="ritual" onclick="setView('ritual')">–†–∏—Ç—É–∞–ª</button></div><div class="hdr-b"><button class="hb" onclick="toggleSearch()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="7"/><path d="m21 21-4.35-4.35"/></svg></button><button class="hb" onclick="toggleMenu()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg></button></div></div>
<div class="menu-dd" id="menu-dd">
<div class="menu-item" id="dm-toggle" onclick="toggleDark();toggleMenu()">üåô –ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º</div>
<div class="menu-item" onclick="doExport();toggleMenu()">üì§ –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—Å—Ç</div>
<div class="menu-item" onclick="doExportJSON();toggleMenu()">üíæ –≠–∫—Å–ø–æ—Ä—Ç JSON</div>
<div class="menu-item" onclick="doImportJSON();toggleMenu()">üì• –ò–º–ø–æ—Ä—Ç JSON</div>
</div>
<input type="file" id="imp-file" accept=".json" style="display:none">
<div class="sub-bar" id="sub-bar"><button class="sub" data-s="list" onclick="setSub('list')">–°–ø–∏—Å–æ–∫</button><span class="sub-dot">¬∑</span><button class="sub on" data-s="cards" onclick="setSub('cards')">–ö–∞—Ä—Ç–æ—á–∫–∏</button><span class="sub-dot">¬∑</span><button class="sub" data-s="personal" onclick="setSub('personal')">–õ–∏—á–Ω—ã–µ</button></div>
<div class="proj-bar" id="proj-bar"><button class="proj-btn" id="proj-btn" onclick="toggleDD()"><span class="pbl" id="pbl">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</span><span class="pbc" id="pbc"></span><span class="pba">‚ñæ</span></button><div class="proj-dd" id="proj-dd"><div class="proj-search"><input type="text" id="proj-si" placeholder="–ù–∞–π—Ç–∏ –ø—Ä–æ–µ–∫—Ç..." oninput="filterDD(this.value)" autocomplete="off"></div><div id="proj-list"></div></div></div>
</div>
<div class="tsrch" id="tsrch"><input type="text" id="tsrch-i" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á..." oninput="onSearch(this.value)"></div>
<div class="ptabs" id="ptabs"></div>
<div class="cv on" id="v-cards"><div class="cf" id="cf"></div><button class="fab" onmousedown="toggleQA()" ontouchend="event.preventDefault();toggleQA()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button><div class="qadd" id="qadd"><input type="text" id="qa-in" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞..." autocomplete="off"><div class="qadd-h">Enter ¬∑ !!! –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ¬∑ #–ø—Ä–æ–µ–∫—Ç</div></div></div>
<div class="lv" id="v-list"><div class="ln"><input type="text" id="li-in" placeholder="+ –∑–∞–¥–∞—á–∞ (!!! –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #–ø—Ä–æ–µ–∫—Ç)" autocomplete="off"></div><div class="ls" id="ls"></div></div>
<div class="nv" id="v-notes">
<div class="nh"><span>–ó–∞–º–µ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ¬∑ <code>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏</code> ‚Äî –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–∏</span></div>
<div class="na"><textarea class="ne" id="ne" placeholder="–ü–∏—à–∏ –∑–∞–º–µ—Ç–∫–∏ –∏–ª–∏ –∑–∞–¥–∞—á–∏..." oninput="saveNotes()"></textarea></div>
<div class="nb-wrap"><button class="nb" onclick="parseNotes()">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞</button></div>
</div>
<div class="rv" id="v-ritual"><div class="rf" id="rf"></div></div>
<div class="pv" id="v-personal">
<div class="pv-hdr"><span class="pv-title">–õ–∏—á–Ω–æ–µ</span><span class="pv-cnt" id="pv-cnt"></span></div>
<div class="pv-input"><input type="text" id="pv-in" placeholder="+ –ª–∏—á–Ω–∞—è –∑–∞–¥–∞—á–∞..." autocomplete="off"></div>
<div class="pv-list" id="pv-list"></div>
</div>
<div class="bot"><div class="bot-i" id="bot-i"></div><button class="hb" onclick="openSheet()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div>
</div>
<div class="ov" id="ov" onclick="closeSheet()"></div>
<div class="sht" id="sht"><div class="sht-h"></div><h3>–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3><input class="si" id="sh-n" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" autocomplete="off"><button class="sbt" onclick="addProj()">–°–æ–∑–¥–∞—Ç—å</button></div>
<div class="tst" id="tst"></div>
</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EMBEDDED BACKUP DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var BACKUP_TASKS = [];
var BACKUP_PROJECTS = [];
var BACKUP_RITUAL = {morning:[],evening:[],checks:{},lastReset:""};

var T=[],P=[],view='tasks',sub='cards',proj='all',taskQ='',showDone=true,lastDel=null,ddOpen=false,qaOpen=false,ptabsOpen=false;
var PT=[]; // Personal tasks ‚Äî separate, not exported
var darkMode=false;

function save(){try{localStorage.setItem('s7t',JSON.stringify(T));localStorage.setItem('s7p',JSON.stringify(P))}catch(e){}}
function savePersonal(){try{localStorage.setItem('s7pt',JSON.stringify(PT))}catch(e){}}
function saveNotes(){try{localStorage.setItem('s7notes',document.getElementById('ne').value)}catch(e){}}
function loadNotes(){try{var n=localStorage.getItem('s7notes');if(n!==null)document.getElementById('ne').value=n}catch(e){}}

function loadAll(){
try{
var t=localStorage.getItem('s7t');
var p=localStorage.getItem('s7p');
// If no data in localStorage, load from backup
if(!t&&!p){
  T=BACKUP_TASKS;P=BACKUP_PROJECTS;save();
}else{
  if(t)T=JSON.parse(t);
  if(p)P=JSON.parse(p);
}
var pt=localStorage.getItem('s7pt');
if(pt)PT=JSON.parse(pt);
}catch(e){}
view=localStorage.getItem('s7v')||'tasks';
sub=localStorage.getItem('s7s')||'cards';
proj=localStorage.getItem('s7f')||'all';
// Dark mode
darkMode=localStorage.getItem('s7dark')==='1';
applyDark();
}
function sv(){localStorage.setItem('s7v',view);localStorage.setItem('s7f',proj);localStorage.setItem('s7s',sub)}
function esc(s){var d=document.createElement('div');d.textContent=s||'';return d.innerHTML}
var CL=['#A855C7','#D98A08','#2EBD52','#E8453A','#1A7AE6','#4ABDD4','#B09A20','#A68960'];
function pC(i){return CL[((i%CL.length)+CL.length)%CL.length]}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DARK MODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleDark(){darkMode=!darkMode;localStorage.setItem('s7dark',darkMode?'1':'0');applyDark()}
function applyDark(){document.documentElement.classList.toggle('dark',darkMode);var el=document.getElementById('dm-toggle');if(el)el.textContent=darkMode?'‚òÄÔ∏è –î–Ω–µ–≤–Ω–æ–π —Ä–µ–∂–∏–º':'üåô –ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º'}

function fil(){var t=T.slice();if(proj!=='all')t=t.filter(function(x){return x.project===proj});if(taskQ){var q=taskQ.toLowerCase();t=t.filter(function(x){return x.text.toLowerCase().indexOf(q)>=0||(x.project||'').toLowerCase().indexOf(q)>=0})}return t}
function grouped(items){var map={};items.forEach(function(t){var p=t.project||'–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞';if(!map[p])map[p]={name:p,un:[],dn:[]};if(t.done)map[p].dn.push(t);else map[p].un.push(t)});return Object.values(map).sort(function(a,b){return b.un.length-a.un.length||a.name.localeCompare(b.name)})}

function render(){rPB();rBot();rPTabs();if(sbOpen||window.innerWidth>=600)rSB();if(sub==='cards')rCards();else if(sub==='list')rList()}
function togglePtabs(){if(window.innerWidth>=600)return;ptabsOpen=!ptabsOpen;document.getElementById('ptabs').classList.toggle('ptabs-open',ptabsOpen)}
function rPTabs(){var el=document.getElementById('ptabs');if(view!=='tasks'){el.classList.remove('ptabs-open');ptabsOpen=false;return}var h='<div class="ptab'+(proj==='all'?' on':'')+'" onclick="selProj(\'all\')">–í—Å–µ</div>';P.forEach(function(p){var en=esc(p.name).replace(/'/g,"\\'");var label=p.name.length>9?p.name.slice(0,9):p.name;h+='<div class="ptab'+(proj===p.name?' on':'')+'" onclick="selProj(\''+en+'\')">'+esc(label)+'</div>'});el.innerHTML=h}
function rPB(){var c=proj==='all'?T.filter(function(t){return!t.done}).length:T.filter(function(t){return t.project===proj&&!t.done}).length;var lbl=document.getElementById('pbl');lbl.textContent=proj==='all'?'–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã':proj;lbl.classList.toggle('sel',proj!=='all');document.getElementById('pbc').textContent=c+''}
function rDD(q){q=q||'';var el=document.getElementById('proj-list'),ql=q.toLowerCase();var items=ql?P.filter(function(p){return p.name.toLowerCase().indexOf(ql)>=0}):P;var h='<div class="pi '+(proj==='all'?'on':'')+'" onclick="selProj(\'all\')"><div class="pid" style="background:var(--text)"></div><span class="pin" style="font-weight:600">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</span><span class="pic">'+T.filter(function(t){return!t.done}).length+'</span></div>';items.forEach(function(p){var i=P.indexOf(p),cnt=T.filter(function(t){return t.project===p.name&&!t.done}).length,en=esc(p.name).replace(/'/g,"\\'");h+='<div class="pi '+(proj===p.name?'on':'')+'" onclick="selProj(\''+en+'\')"><div class="pid" style="background:'+pC(i)+'"></div><span class="pin">'+esc(p.name)+'</span><span class="pic">'+(cnt||'')+'</span></div>'});if(!items.length&&ql)h+='<div class="proj-no">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</div>';el.innerHTML=h}
function rBot(){var a=T.filter(function(t){return!t.done}).length;document.getElementById('bot-i').innerHTML='<b>'+a+'</b> –∞–∫—Ç–∏–≤–Ω—ã—Ö ¬∑ '+T.length+' –≤—Å–µ–≥–æ ¬∑ '+P.length+' –ø—Ä–æ–µ–∫—Ç–æ–≤'}

var CHK='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>';
var XS='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
var GRIP='<svg viewBox="0 0 24 24" fill="currentColor"><circle cx="9" cy="6" r="1.5"/><circle cx="15" cy="6" r="1.5"/><circle cx="9" cy="12" r="1.5"/><circle cx="15" cy="12" r="1.5"/><circle cx="9" cy="18" r="1.5"/><circle cx="15" cy="18" r="1.5"/></svg>';

function secH(n,c){return'<div class="sec"><div class="sec-row"><div class="sec-name" contenteditable="true" data-orig="'+esc(n)+'" spellcheck="false">'+esc(n)+'</div><span class="sec-cnt">'+c+'</span></div></div>'}
function cH(t){return'<div class="cc '+(t.pri==='high'?'ph':t.pri==='medium'?'pm':'')+' '+(t.done?'dn':'')+'" data-id="'+t.id+'"><div class="sl">'+CHK+'</div><div class="sr">'+XS+'</div><div class="cc-t">'+esc(t.text)+'</div></div>'}
function lH(t){return'<div class="li '+(t.done?'dn':'')+'" data-id="'+t.id+'"><div class="lp '+t.pri+'"></div><div class="lk" onclick="event.stopPropagation();tglDone(\''+t.id+'\')">'+CHK+'</div><div class="lt" contenteditable="'+(t.done?'false':'true')+'" data-id="'+t.id+'" onblur="onEdit(this)" onkeydown="if(event.key===\'Enter\'){event.preventDefault();this.blur()}">'+esc(t.text)+'</div><div class="ldel" onclick="event.stopPropagation();delTask(\''+t.id+'\')" title="–£–¥–∞–ª–∏—Ç—å">'+XS+'</div><div class="ldh">'+GRIP+'</div></div>'}

function rCards(){var el=document.getElementById('cf'),items=fil();if(!items.length){el.innerHTML='<div class="emp"><h3>–ü—É—Å—Ç–æ</h3><p>–ù–∞–∂–º–∏ + –≤–Ω–∏–∑—É</p></div>';return}if(proj!=='all'){var u=items.filter(function(t){return!t.done}),d=items.filter(function(t){return t.done}),h='';u.forEach(function(t){h+=cH(t)});if(d.length){h+='<div class="sh">–ì–æ—Ç–æ–≤–æ ¬∑ '+d.length+'<button onclick="tglShow()">'+(showDone?'—Å–∫—Ä—ã—Ç—å':'–ø–æ–∫–∞–∑–∞—Ç—å')+'</button></div>';if(showDone)d.forEach(function(t){h+=cH(t)})}el.innerHTML=h;el.querySelectorAll('.cc').forEach(function(c){swipe(c)});return}var gr=grouped(items),h='';gr.forEach(function(g){if(!g.un.length&&!showDone)return;h+=secH(g.name,g.un.length);g.un.forEach(function(t){h+=cH(t)});if(g.dn.length&&showDone)g.dn.forEach(function(t){h+=cH(t)})});el.innerHTML=h;el.querySelectorAll('.cc').forEach(function(c){swipe(c)});el.querySelectorAll('.sec-name').forEach(function(n){bindRename(n)})}

function rList(){var el=document.getElementById('ls'),items=fil();if(!items.length){el.innerHTML='<div class="emp"><h3>–ü—É—Å—Ç–æ</h3><p>–ü–µ—á–∞—Ç–∞–π –≤–≤–µ—Ä—Ö—É</p></div>';return}if(proj!=='all'){var u=items.filter(function(t){return!t.done}),d=items.filter(function(t){return t.done}),h='';u.forEach(function(t){h+=lH(t)});if(d.length){h+='<div class="sh">–ì–æ—Ç–æ–≤–æ ¬∑ '+d.length+'<button onclick="tglShow()">'+(showDone?'—Å–∫—Ä—ã—Ç—å':'–ø–æ–∫–∞–∑–∞—Ç—å')+'</button></div>';if(showDone)d.forEach(function(t){h+=lH(t)})}el.innerHTML=h;initDrag(el);return}var gr=grouped(items),h='';gr.forEach(function(g){if(!g.un.length&&!showDone)return;h+=secH(g.name,g.un.length);g.un.forEach(function(t){h+=lH(t)});if(g.dn.length&&showDone)g.dn.forEach(function(t){h+=lH(t)})});el.innerHTML=h;el.querySelectorAll('.sec-name').forEach(function(n){bindRename(n)});initDrag(el)}

function swipe(card){var sx=0,cx=0,sy=0,active=false,dir=null,THR=80;card.addEventListener('touchstart',function(e){var t=e.touches[0];sx=t.clientX;sy=t.clientY;cx=0;active=true;dir=null;card.style.transition='none'},{passive:true});card.addEventListener('touchmove',function(e){if(!active)return;var t=e.touches[0],dx=t.clientX-sx,dy=t.clientY-sy;if(dir===null){if(Math.abs(dx)>8)dir='h';else if(Math.abs(dy)>8){dir='v';active=false;return}else return}if(dir!=='h')return;e.preventDefault();cx=dx;card.style.transform='translateX('+(dx*.55)+'px)';var p=Math.min(Math.abs(dx)/THR,1),sl=card.querySelector('.sl'),sr=card.querySelector('.sr');if(dx>10){sl.style.opacity=p;sr.style.opacity=0}else if(dx<-10){sr.style.opacity=p;sl.style.opacity=0}else{sl.style.opacity=0;sr.style.opacity=0}},{passive:false});card.addEventListener('touchend',function(){if(!active)return;active=false;var sl=card.querySelector('.sl'),sr=card.querySelector('.sr');if(sl)sl.style.opacity=0;if(sr)sr.style.opacity=0;var id=card.dataset.id;if(cx>THR){card.style.transition='transform .2s,opacity .2s';card.style.transform='translateX(110%)';card.style.opacity='0';setTimeout(function(){card.style.maxHeight='0';card.style.margin='0';card.style.padding='0';card.style.overflow='hidden';card.style.transition='all .15s';setTimeout(function(){tglDone(id)},150)},200)}else if(cx<-THR){card.style.transition='transform .2s,opacity .2s';card.style.transform='translateX(-110%)';card.style.opacity='0';setTimeout(function(){card.style.maxHeight='0';card.style.margin='0';card.style.padding='0';card.style.overflow='hidden';card.style.transition='all .15s';setTimeout(function(){delTask(id)},150)},200)}else{card.style.transition='transform .15s';card.style.transform=''}})}

function initDrag(ct){var dragEl=null,startY=0;ct.querySelectorAll('.ldh').forEach(function(h){h.addEventListener('touchstart',function(e){e.stopPropagation();dragEl=h.closest('.li');if(!dragEl)return;startY=e.touches[0].clientY;dragEl.classList.add('dragging')},{passive:true})});ct.addEventListener('touchmove',function(e){if(!dragEl)return;e.preventDefault();dragEl.style.transform='translateY('+(e.touches[0].clientY-startY)+'px)';dragEl.style.zIndex='100'},{passive:false});ct.addEventListener('touchend',function(){if(!dragEl)return;var rect=dragEl.getBoundingClientRect(),mid=rect.top+rect.height/2;var items=[].slice.call(ct.querySelectorAll('.li'));var srcId=dragEl.dataset.id,srcIdx=T.findIndex(function(t){return t.id===srcId}),bestIdx=-1,bestDist=9999;items.forEach(function(it){if(it===dragEl)return;var r=it.getBoundingClientRect(),m=r.top+r.height/2,d=Math.abs(mid-m);if(d<bestDist){bestDist=d;bestIdx=T.findIndex(function(t){return t.id===it.dataset.id});if(mid>m)bestIdx++}});if(srcIdx>=0&&bestIdx>=0&&srcIdx!==bestIdx){var item=T.splice(srcIdx,1)[0];if(bestIdx>srcIdx)bestIdx--;T.splice(bestIdx,0,item);save()}dragEl.style.transform='';dragEl.style.zIndex='';dragEl.classList.remove('dragging');dragEl=null;render()})}

function bindRename(el){el.addEventListener('blur',function(){var orig=el.dataset.orig,nn=el.textContent.trim();if(!nn||nn===orig)return;var p=P.find(function(x){return x.name===orig});if(!p)return;p.name=nn;T.forEach(function(t){if(t.project===orig)t.project=nn});if(proj===orig){proj=nn;sv()}save();toast('‚úé '+nn);render()});el.addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();el.blur()}})}

function toggleQA(){qaOpen=!qaOpen;var qa=document.getElementById('qadd');var inp=document.getElementById('qa-in');qa.classList.toggle('on',qaOpen);if(qaOpen){inp.value='';inp.focus();inp.click();setTimeout(function(){inp.focus()},50);setTimeout(function(){inp.focus()},150)}}
document.getElementById('qa-in').addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();addInput(e.target)}});
document.getElementById('li-in').addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();addInput(e.target)}});
function addInput(inp){var v=inp.value.trim();if(!v)return;var t=parseLine(v);T.push(t);save();inp.value='';render();toast('+ '+t.text.slice(0,25))}
function parseNotes(){var ta=document.getElementById('ne'),lines=ta.value.split('\n').map(function(l){return l.trim()}).filter(Boolean);if(!lines.length){toast('–ù–∞–ø–∏—à–∏ –∑–∞–¥–∞—á–∏');return}var c=0;lines.forEach(function(l){T.push(parseLine(l));c++});save();ta.value='';saveNotes();toast(c+' –∑–∞–¥–∞—á');setView('tasks')}
function maybeParseLeave(){/* Notes now persist, don't auto-parse on leave */}
function parseLine(raw){var pri='medium',text=raw;if(text.indexOf('!!! ')===0){pri='high';text=text.slice(4)}else if(text.indexOf('!! ')===0){pri='medium';text=text.slice(3)}else if(text.indexOf('! ')===0){pri='low';text=text.slice(2)}var project=proj!=='all'?proj:(P.length?P[0].name:'');var pm=text.match(/#([–∞-—è–ê-–Ø—ë–Åa-zA-Z0-9\-]+)/);if(pm){var tag=pm[1].toLowerCase();var found=P.find(function(p){return p.name.toLowerCase().indexOf(tag)>=0});if(found)project=found.name;text=text.replace(pm[0],'').trim()}return{id:'t'+Date.now()+Math.random().toString(36).slice(2,6),text:text,project:project,pri:pri,done:false,ts:Date.now()}}

function setView(v){view=v;sv();document.querySelectorAll('.vb').forEach(function(b){b.classList.toggle('on',b.dataset.v===v)});var isTasks=v==='tasks';document.getElementById('v-cards').classList.toggle('on',isTasks&&sub==='cards');document.getElementById('v-list').classList.toggle('on',isTasks&&sub==='list');document.getElementById('v-notes').classList.toggle('on',v==='notes');document.getElementById('v-ritual').classList.toggle('on',v==='ritual');document.getElementById('v-personal').classList.toggle('on',isTasks&&sub==='personal');document.getElementById('proj-bar').style.display=(v==='ritual'||v==='notes')?'none':'';if(isTasks&&sub==='personal')document.getElementById('proj-bar').style.display='none';document.getElementById('tsrch').style.display=(v==='tasks')?'':'none';document.getElementById('sub-bar').style.display=isTasks?'':'none';if(!isTasks||sub!=='cards'){qaOpen=false;document.getElementById('qadd').classList.remove('on')}if(v==='ritual'){rRitual()}else if(v==='personal'){rPersonal()}else if(v==='notes'){loadNotes()}else if(v==='tasks'&&sub==='personal'){rPersonal()}else{render()}if(isTasks&&sub==='list')mFocus('li-in');if(v==='notes')mFocus('ne');if(isTasks&&sub==='personal')mFocus('pv-in')}
function setSub(s){sub=s;sv();document.querySelectorAll('.sub').forEach(function(b){b.classList.toggle('on',b.dataset.s===s)});document.getElementById('v-cards').classList.toggle('on',s==='cards');document.getElementById('v-list').classList.toggle('on',s==='list');document.getElementById('v-personal').classList.toggle('on',s==='personal');if(s!=='cards'){qaOpen=false;document.getElementById('qadd').classList.remove('on')}if(s==='personal'){document.getElementById('proj-bar').style.display='none';rPersonal()}else{document.getElementById('proj-bar').style.display=''}if(s==='personal')mFocus('pv-in');else if(s==='list')mFocus('li-in');else render()}
function mFocus(id){setTimeout(function(){var el=document.getElementById(id);if(el){el.focus();el.click()}},150)}
function tglShow(){showDone=!showDone;render()}
function tglDone(id){var t=T.find(function(x){return x.id===id});if(!t)return;t.done=!t.done;save();toast(t.done?'‚úì':'‚Ü©');render()}
function delTask(id){var i=T.findIndex(function(x){return x.id===id});if(i<0)return;lastDel={task:T[i],idx:i};T.splice(i,1);save();toast('–£–¥–∞–ª–µ–Ω–æ',true);render()}
function undoDel(){if(!lastDel)return;T.splice(lastDel.idx,0,lastDel.task);save();lastDel=null;hideToast();render()}
function onEdit(el){var id=el.dataset.id,text=el.textContent.trim();var t=T.find(function(x){return x.id===id});if(!t)return;if(!text){delTask(id);return}t.text=text;save()}

function toggleDD(){ddOpen=!ddOpen;document.getElementById('proj-btn').classList.toggle('open',ddOpen);document.getElementById('proj-dd').classList.toggle('open',ddOpen);if(ddOpen){document.getElementById('proj-si').value='';rDD();setTimeout(function(){document.getElementById('proj-si').focus()},100);setTimeout(function(){document.addEventListener('click',closeDDOut)},10)}else document.removeEventListener('click',closeDDOut)}
function closeDDOut(e){if(!document.getElementById('proj-bar').contains(e.target))closeDD()}
function closeDD(){ddOpen=false;document.getElementById('proj-btn').classList.remove('open');document.getElementById('proj-dd').classList.remove('open');document.removeEventListener('click',closeDDOut)}
function filterDD(q){rDD(q)}
function selProj(n){proj=n;sv();closeDD();render()}
function openSheet(){var sht=document.getElementById('sht');if(window.innerWidth>=600){var main=document.querySelector('.app-main');var r=main.getBoundingClientRect();sht.style.left=r.left+'px';sht.style.right=(window.innerWidth-r.right)+'px';sht.style.maxWidth='none'}else{sht.style.left='';sht.style.right='';sht.style.maxWidth='480px'}document.getElementById('ov').classList.add('on');sht.classList.add('on');setTimeout(function(){document.getElementById('sh-n').focus()},300)}
function closeSheet(){document.getElementById('ov').classList.remove('on');document.getElementById('sht').classList.remove('on');var sht=document.getElementById('sht');sht.style.left='';sht.style.right='';sht.style.maxWidth=''}
function addProj(){var n=document.getElementById('sh-n').value.trim();if(!n)return;if(P.find(function(p){return p.name===n})){toast('–£–∂–µ –µ—Å—Ç—å');return}P.push({name:n,idx:P.length});save();document.getElementById('sh-n').value='';closeSheet();render();toast('+ '+n)}
function toggleSearch(){var w=document.getElementById('tsrch'),i=document.getElementById('tsrch-i');if(w.classList.contains('on')){w.classList.remove('on');taskQ='';i.value='';render()}else{w.classList.add('on');i.focus()}}
function onSearch(q){taskQ=q;render()}
function doExport(){var groups={};T.forEach(function(t){if(!groups[t.project])groups[t.project]=[];groups[t.project].push(t)});var text='Surf\n\n';Object.keys(groups).sort().forEach(function(p){text+=p+'\n';groups[p].forEach(function(t){text+='  '+(t.done?'‚úì':'‚óã')+' '+t.text+'\n'});text+='\n'});if(navigator.share)navigator.share({text:text}).catch(function(){});else{var b=new Blob([text],{type:'text/plain'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download='surf.txt';a.click();URL.revokeObjectURL(u)}toast('üì¶')}
function doExportJSON(){var notes='';try{notes=localStorage.getItem('s7notes')||''}catch(e){}var data={tasks:T,projects:P,ritual:R,notes:notes};var b=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});var u=URL.createObjectURL(b);var a=document.createElement('a');a.href=u;a.download='surf-backup.json';a.click();URL.revokeObjectURL(u);toast('üíæ JSON')}
function doImportJSON(){document.getElementById('imp-file').click()}
document.getElementById('imp-file').addEventListener('change',function(e){var file=e.target.files[0];if(!file)return;var reader=new FileReader();reader.onload=function(ev){try{var data=JSON.parse(ev.target.result);if(data.tasks)T=data.tasks;if(data.projects)P=data.projects;if(data.ritual){R=data.ritual;saveR()}if(typeof data.notes==='string'){localStorage.setItem('s7notes',data.notes)}save();toast('üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ');setView(view)}catch(err){toast('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞')}};reader.readAsText(file);e.target.value=''});
function toggleMenu(){var m=document.getElementById('menu-dd');m.classList.toggle('open');if(m.classList.contains('open'))setTimeout(function(){document.addEventListener('click',closeMenuOut)},10);else document.removeEventListener('click',closeMenuOut)}
function closeMenuOut(e){if(!document.getElementById('menu-dd').contains(e.target)){document.getElementById('menu-dd').classList.remove('open');document.removeEventListener('click',closeMenuOut)}}
var tt;function toast(m,u){var e=document.getElementById('tst');e.innerHTML=m+(u?' <a onclick="undoDel()">–û—Ç–º–µ–Ω–∏—Ç—å</a>':'');e.classList.add('show');clearTimeout(tt);tt=setTimeout(hideToast,u?4000:1200)}
function hideToast(){document.getElementById('tst').classList.remove('show')}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PERSONAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('pv-in').addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();addPersonal(e.target)}});
function addPersonal(inp){var v=inp.value.trim();if(!v)return;PT.push({id:'p'+Date.now()+Math.random().toString(36).slice(2,5),text:v,done:false,ts:Date.now()});savePersonal();inp.value='';rPersonal();toast('+ '+v.slice(0,25))}
function rPersonal(){var el=document.getElementById('pv-list');var active=PT.filter(function(t){return!t.done});var done=PT.filter(function(t){return t.done});document.getElementById('pv-cnt').textContent=active.length+' –∞–∫—Ç–∏–≤–Ω—ã—Ö';if(!PT.length){el.innerHTML='<div class="emp"><h3>–ü—É—Å—Ç–æ</h3><p>–î–æ–±–∞–≤—å –ª–∏—á–Ω—É—é –∑–∞–¥–∞—á—É</p></div>';return}var h='';active.forEach(function(t){h+=pLH(t)});if(done.length){h+='<div class="sh">–ì–æ—Ç–æ–≤–æ ¬∑ '+done.length+'<button onclick="tglShowP()">'+(showDoneP?'—Å–∫—Ä—ã—Ç—å':'–ø–æ–∫–∞–∑–∞—Ç—å')+'</button></div>';if(showDoneP)done.forEach(function(t){h+=pLH(t)})}el.innerHTML=h}
var showDoneP=true;
function tglShowP(){showDoneP=!showDoneP;rPersonal()}
function pLH(t){return'<div class="li '+(t.done?'dn':'')+'" data-pid="'+t.id+'"><div class="lk" onclick="event.stopPropagation();tglDoneP(\''+t.id+'\')">'+CHK+'</div><div class="lt" contenteditable="'+(t.done?'false':'true')+'" data-pid="'+t.id+'" onblur="onEditP(this)" onkeydown="if(event.key===\'Enter\'){event.preventDefault();this.blur()}">'+esc(t.text)+'</div><div class="ldel" onclick="event.stopPropagation();delPersonal(\''+t.id+'\')" title="–£–¥–∞–ª–∏—Ç—å">'+XS+'</div></div>'}
function tglDoneP(id){var t=PT.find(function(x){return x.id===id});if(!t)return;t.done=!t.done;savePersonal();toast(t.done?'‚úì':'‚Ü©');rPersonal()}
function delPersonal(id){var i=PT.findIndex(function(x){return x.id===id});if(i<0)return;PT.splice(i,1);savePersonal();toast('–£–¥–∞–ª–µ–Ω–æ');rPersonal()}
function onEditP(el){var id=el.dataset.pid,text=el.textContent.trim();var t=PT.find(function(x){return x.id===id});if(!t)return;if(!text){delPersonal(id);return}t.text=text;savePersonal()}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RITUAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var R={morning:[],evening:[],checks:{},lastReset:''};
var RBLOCKS=[{key:'morning',label:'–£—Ç—Ä–æ ‚òÄ'},{key:'evening',label:'–í–µ—á–µ—Ä üåô'}];
var R_DEFAULTS={morning:[{id:'rd1',text:'–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã'},{id:'rd2',text:'–Ø–Ω–∞'}],evening:[{id:'rd3',text:'–ê–Ω–∞–ª–∏–∑ —á–∞—Ç–æ–≤'}]};
function saveR(){try{localStorage.setItem('s8r',JSON.stringify(R))}catch(e){}}
function loadR(){try{var r=localStorage.getItem('s8r');if(r){R=JSON.parse(r)}else{// Load from backup
  R=BACKUP_RITUAL;saveR()}}catch(e){}if(!R.checks)R.checks={};if(!R.lastReset)R.lastReset='';if(!R.morning)R.morning=[];if(!R.evening)R.evening=[];if(!R.morning.length&&!R.evening.length&&!localStorage.getItem('s8r')){R.morning=R_DEFAULTS.morning.slice();R.evening=R_DEFAULTS.evening.slice();saveR()}checkReset()}
function checkReset(){var now=new Date(),h=now.getHours(),today=now.toISOString().slice(0,10);var resetDay=h<6?new Date(now.getTime()-86400000).toISOString().slice(0,10):today;if(R.lastReset!==resetDay){R.checks={};R.lastReset=resetDay;saveR()}}
function rTotal(){var done=0,total=0;RBLOCKS.forEach(function(b){var items=R[b.key]||[];total+=items.length;items.forEach(function(it){if(R.checks[it.id])done++})});return{done:done,total:total}}
function rRitual(){var el=document.getElementById('rf');checkReset();var st=rTotal();var pct=st.total?Math.round(st.done/st.total*100):0;var h='<div class="r-prog"><div class="r-bar"><div class="r-bar-fill" style="width:'+pct+'%"></div></div><div class="r-cnt">'+st.done+'/'+st.total+'</div></div>';RBLOCKS.forEach(function(b){var items=R[b.key]||[];var bc=0;items.forEach(function(it){if(R.checks[it.id])bc++});h+='<div class="r-sec"><div class="r-sec-hdr">'+b.label+'<span class="r-sec-cnt">'+bc+'/'+items.length+'</span></div>';items.forEach(function(it){var ck=R.checks[it.id]?true:false;h+='<div class="r-item'+(ck?' checked':'')+'" data-rid="'+it.id+'"><div class="r-chk'+(ck?' on':'')+'" onclick="event.stopPropagation();tglR(\''+it.id+'\')" ontouchend="event.stopPropagation();event.preventDefault();tglR(\''+it.id+'\')">'+CHK+'</div><div class="r-txt" contenteditable="true" data-rid="'+it.id+'" data-block="'+b.key+'" onblur="editR(this)" onkeydown="if(event.key===\'Enter\'){event.preventDefault();this.blur()}">'+esc(it.text)+'</div><div class="r-del" onclick="delR(\''+b.key+'\',\''+it.id+'\')">'+XS+'</div></div>'});h+='<div class="r-add" onclick="addR(\''+b.key+'\')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> –î–æ–±–∞–≤–∏—Ç—å</div></div>'});el.innerHTML=h}
function tglR(id){R.checks[id]=!R.checks[id];saveR();rRitual()}
function addR(block){if(!R[block])R[block]=[];var id='r'+Date.now()+Math.random().toString(36).slice(2,5);R[block].push({id:id,text:''});saveR();rRitual();setTimeout(function(){var el=document.querySelector('.r-txt[data-rid="'+id+'"]');if(el){el.focus()}},50)}
function editR(el){var id=el.dataset.rid,block=el.dataset.block,text=el.textContent.trim();var items=R[block]||[];var it=items.find(function(x){return x.id===id});if(!it)return;if(!text){delR(block,id);return}it.text=text;saveR()}
function delR(block,id){R[block]=(R[block]||[]).filter(function(x){return x.id!==id});delete R.checks[id];saveR();rRitual();toast('–£–¥–∞–ª–µ–Ω–æ')}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var sbOpen=false;
function openSB(){sbOpen=true;document.getElementById('sb').classList.add('on');document.getElementById('sb-ov').classList.add('on');rSB()}
function closeSB(){sbOpen=false;document.getElementById('sb').classList.remove('on');document.getElementById('sb-ov').classList.remove('on')}
function rSB(){var el=document.getElementById('sb-list');var allCnt=T.filter(function(t){return!t.done}).length;var h='<div class="sb-item'+(proj==='all'?' on':'')+'" onclick="sbPick(\'all\')"><div class="sb-dot" style="background:var(--text)"></div><span class="sb-name" style="font-weight:600">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</span><span class="sb-cnt">'+allCnt+'</span></div>';P.forEach(function(p,i){var cnt=T.filter(function(t){return t.project===p.name&&!t.done}).length;var en=esc(p.name).replace(/'/g,"\\'");h+='<div class="sb-item'+(proj===p.name?' on':'')+'" onclick="sbPick(\''+en+'\')"><div class="sb-dot" style="background:'+pC(i)+'"></div><span class="sb-name">'+esc(p.name)+'</span><span class="sb-cnt">'+(cnt||'')+'</span></div>'});el.innerHTML=h}
function sbPick(n){proj=n;sv();if(window.innerWidth<600)closeSB();render()}
(function(){var sx=0,sy=0,tracking=false,moved=false;document.addEventListener('touchstart',function(e){if(window.innerWidth<600)return;if(sbOpen)return;var t=e.touches[0];if(t.clientX<20){sx=t.clientX;sy=t.clientY;tracking=true;moved=false}},{passive:true});document.addEventListener('touchmove',function(e){if(!tracking)return;var t=e.touches[0],dx=t.clientX-sx,dy=t.clientY-sy;if(!moved&&Math.abs(dx)>10&&Math.abs(dx)>Math.abs(dy)){moved=true}if(moved){var sb=document.getElementById('sb');sb.style.transition='none';sb.style.transform='translateX('+Math.min(0,dx-260)+'px)'}},{passive:true});document.addEventListener('touchend',function(e){if(!tracking)return;tracking=false;var sb=document.getElementById('sb');sb.style.transition='';if(moved){var t=e.changedTouches[0],dx=t.clientX-sx;if(dx>80){openSB()}else{sb.style.transform=''}}moved=false})})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
loadAll();loadR();
if(window.innerWidth>=600){sbOpen=true;rSB()}
setView(view);
</script>
</body>
</html>
